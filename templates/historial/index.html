{% extends 'base.html' %}
{% block title %}Historial de Servicios{% endblock %}

{% block content %}
<h2 class="fw-bold mb-4">Historial de Servicios</h2>

<a href="{{ url_for('historial.create') }}"
   class="btn btn-primary mb-4 shadow-sm rounded-pill">
    Registrar Servicio
</a>

<div class="card shadow-lg border-0 glass-card">
    <div class="card-body">

        <!-- SCROLL HORIZONTAL -->
        <div class="table-responsive">
            <table id="tablaHistorial"
                   class="table table-striped table-hover align-middle text-center text-dark w-100">

                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Fecha</th>
                        <th>Cliente</th>
                        <th>Servicio</th>
                        <th>Empleado</th>
                        <th>Satisfacción</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    {% for r in registros %}
                    <tr>
                        <td>{{ r.id }}</td>
                        <td>{{ r.fecha.strftime('%Y-%m-%d') }}</td>
                        <td>{{ r.cliente.nombre }}</td>
                        <td>{{ r.servicio.nombre }}</td>
                        <td>{{ r.empleado.nombre if r.empleado else 'Sin asignar' }}</td>
                        <td>{{ r.satisfaccion }}</td>
                        <td>{{ r.estado }}</td>
                        <td>
                            {% if session.get('usuario_rol') == 'admin' %}
                            <a href="{{ url_for('historial.edit', id=r.id) }}"
                               class="btn btn-warning btn-sm rounded-pill me-1">
                                Editar
                            </a>
                            <a href="{{ url_for('historial.delete', id=r.id) }}"
                               class="btn btn-danger btn-sm rounded-pill"
                               onclick="return confirm('¿Eliminar este registro?')">
                                Eliminar
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function () {
    $('#tablaHistorial').DataTable({
        responsive: false,
        scrollX: true,
        autoWidth: false,
        pageLength: 10,
        language: {
            lengthMenu: "Mostrar _MENU_ registros",
            search: "Buscar:",
            info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
            infoEmpty: "No hay datos disponibles",
            paginate: {
                next: "Siguiente",
                previous: "Anterior"
            }
        }
    });
});
</script>
{% endblock %}
